package org.dependencytrack.model;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsonorg.JsonOrgModule;
import org.cyclonedx.model.vulnerability.Vulnerability;
import org.json.JSONArray;

import javax.jdo.AttributeConverter;
import java.util.List;

public class VulnerabilityPolicyRatingAttributeConverter implements AttributeConverter<List<Vulnerability.Rating>, JSONArray> {
    private static final ObjectMapper MAPPER = new ObjectMapper().registerModule(new JsonOrgModule());

    @Override
    public JSONArray convertToDatastore(List<Vulnerability.Rating> rating) {
        return MAPPER.convertValue(rating, JSONArray.class);
    }

    @Override
    public List<Vulnerability.Rating> convertToAttribute(JSONArray json) {
        return MAPPER.convertValue(json, new TypeReference<List<Vulnerability.Rating>>(){});
    }
}
